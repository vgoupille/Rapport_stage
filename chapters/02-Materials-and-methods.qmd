# Materials and Methods {#sec-materials-and-methods}

## Bacterial culture 


```{mermaid}
%%| fig-cap: "Experimental design for bacterial culture"
%%| fig-width: 6
%%| fig-height: 4
%%| label: fig-experimental-design
graph TD
    A["Start culture *P. brassicacearum PR401* in petri dish"] --> B{"transfer to liquid medium"}
    B --> C["**M9** : Low glucose and iron"]
    B --> D["**M9F** : High glucose and iron"]
    C --> E{3 biological replicates}
    D --> F{3 biological replicates}
    E --> G[**Rep A**]
    E --> H[**Rep B**]
    E --> I[**Rep C**]
    F --> J[**Rep A**]
    F --> K[**Rep B**]
    F --> L[**Rep C**]
    G --> M[OD : **T1**, **T2**, **T3**]
    H --> N[OD : **T1**, **T2**, **T3**]
    I --> O[OD : **T1**, **T2**, **T3**]
    J --> P[OD : **T1**, **T2**, **T3**]
    K --> Q[OD : **T1**, **T2**, **T3**]
    L --> R[OD : **T1**, **T2**, **T3**]
    
    %% Color styling
    A:::start
    B:::decision
    C:::m9f
    D:::m9
    E:::replicate
    F:::replicate
    G:::rep
    H:::rep
    I:::rep
    J:::rep
    K:::rep
    L:::rep
    M:::measurement
    N:::measurement
    O:::measurement
    P:::measurement
    Q:::measurement
    R:::measurement
    
    classDef start fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    classDef decision fill:#fff3e0,stroke:#e65100,stroke-width:2px
    classDef m9 fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px
    classDef m9f fill:#fce4ec,stroke:#c2185b,stroke-width:2px
    classDef replicate fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef rep fill:#fff9c4,stroke:#f57f17,stroke-width:2px
    classDef measurement fill:#e0f2f1,stroke:#004d40,stroke-width:2px
```


An isogenic population of *P. brassicacearum* PR401 was initially cultured on petri dishes and then transferred to different liquid media to investigate the effects of nutrient availability on bacterial growth and gene expression (@fig-experimental-design).

Two distinct culture conditions were applied to the bacteria: M9 medium containing low glucose and low iron concentrations, and M9F medium containing high glucose and high iron concentrations (see @tbl-media for detailed concentrations). Each condition was replicated three times to ensure statistical robustness of the experimental results. The bacterial growth was monitored by measuring optical density (OD) at regular intervals. The growth curves obtained from these measurements are presented (@fig-growth-curves) and (@tbl-growth-curves). This experimental design resulted in a total of 18 conditions: 2 media types × 3 biological replicates × 3 time points, providing comprehensive coverage of the growth dynamics under different nutrient conditions.

{{< embed ../data/data_growth.ipynb#plot_growth >}}

Growth curves for each condition showing the optical density (OD) measurements over time for M9 and M9F media across three biological replicates (Rep A, B, C) at three time points (T1, T2, T3).

The growth curves reveal distinct patterns between the two culture conditions. Bacteria grown in M9F medium (high glucose and iron) exhibited significantly higher growth rates and reached higher optical densities (OD 0.17-0.21 at T1, 0.59-0.63 at T2, 0.74-0.83 at T3) compared to M9 medium (low glucose and iron) which showed limited growth (OD 0.13 at T1, 0.28-0.33 at T2, 0.26 at T3). While M9F cultures showed continued growth from T2 to T3, the growth rate slowed down during this period, indicating the beginning of transition towards stationary phase. The M9 cultures appeared to reach a growth plateau by T3, while M9F cultures maintained higher densities despite the growth deceleration, suggesting nutrient limitation in the M9 condition. Biological replicates showed excellent reproducibility validating the experimental design. 

Cells were collected at each timepoint (T1, T2, T3) from all biological replicates for subsequent single-cell RNA-seq analysis using the microSPLiT protocol.

## microSPLiT protocol

![Schematic representation of the microSPLiT protocol showing the barcoding workflow for single-cell RNA-seq. @gaisser2024 ](../figures/protocol.png){#fig-protocol .lightbox fig-cap="microSPLiT Protocol"}

pas fou rexpliquer en mieux et simple , juste focus sur elements importants 
The microSPLiT (microbial Split-Pool Ligation Transcriptomics) protocol enables single-cell RNA sequencing of bacteria by performing barcoding reactions inside individual cells rather than in separate reaction vessels . This approach maintains single-cell resolution throughout the entire process, from cell fixation to library preparation. The protocol involves multiple rounds of split-pool barcoding where cells are distributed into 96-well plates, barcoded, pooled, and redistributed for subsequent rounds, creating unique barcode combinations that identify individual cells. This method allows for the analysis of transcriptomic heterogeneity within bacterial populations at single-cell resolution, providing insights into gene expression patterns and cellular diversity that would be masked in bulk RNA-seq approaches.

### microSPLiT library and read structure
<!-- 
![microSPLiT library and read structure](../figures/microsplit_library_structure.png){#fig-library-structure fig-cap="microSPLiT library and read structure"}
(@teichlab2024)
final library structure :  -->

split en 4 sous librairies pour meilleur sequençage 

## Pipeline for microSPLiT data processing

```{mermaid}
%%| fig-cap: "Pipeline for microSPLiT data processing"
%%| fig-width: 6
%%| fig-height: 4
%%| label: fig-pipeline
    graph TD
        A[Sequencing data] --> B[Demultiplexing]
    B --> C[Quality Control]
    C --> D[Trimming]
    D --> E[Alignment]
    E --> F[Barcode reading]
    F --> G[Cell clustering]
    G --> H[Cell type annotation]
    H --> I[Differential expression analysis]
```



All preprocessing, quality control, and alignment steps were performed on the GenOuest high-performance computing cluster using SLURM job scripts to ensure efficient and reproducible analysis of large-scale sequencing data.

  
### Sequencing and demultiplexing of libraries

Sequencing was performed on a NovaSeq instrument (Genobird platform) using four different indexes, in paired-end mode. The sequencing facility provided two types of files: raw Illumina BCL files (250 GB) and demultiplexed paired-end FASTQ files (150 GB). For all downstream analyses, only the demultiplexed FASTQ files were used, as the index sequences had already been removed by the platform.

For each index, two paired-end FASTQ files were generated:
    - **R1** contains the cDNA sequence of interest (transcriptome).
    - **R2** contains the cell barcodes and unique molecular identifiers (UMIs).

### Quality control and trimming

- Read quality was assessed using FastQC and MultiQC for all four libraries, on both R1 and R2 files.
- Trimming was performed with Fastp and Cutadapt to retain only the cDNA portions in R1, while R2 was filtered to keep only sequences with valid barcodes, for all four libraries.
- See the appendix for the detailed script.
- After trimming, read quality was reassessed with FastQC and MultiQC for all four libraries (R1 and R2), and the results were merged for global quality assessment.

### Trimming pipeline

Read trimming was performed using a custom multi-step pipeline (see Appendix for the full script) using  Cutadapt [@martin2011] and Fastp [@chen2018]. Each step was designed to address specific technical artifacts and to maximize read quality for downstream analysis:

- **TSO trimming (R1 only):** Removal of template-switching oligo (TSO) sequences from R1 using Cutadapt, as these are present at the 5' end of cDNA reads (represents approximately 24–28% of the reads) (see Appendix Table @tbl-tso-removal for detailed statistics).

TruSeq Read 2 adapter sequence
et I7 in

- **Initial quality and polyG/polyX trimming (R1 and R2):** Removal of low-quality bases and polyG/polyX tails with Fastp on both R1 and R2. PolyG tails are a common artifact in NovaSeq and NextSeq data due to the two-color chemistry, which can miscall G bases at the end of reads when signal intensity drops. This step is essential to avoid false sequence content and improve downstream alignment.
- **PolyA trimming (R1 only):** Removal of polyA stretches (polyA15) from R1 using Cutadapt, specifically targeting polyA sequences located immediately downstream of the cDNA insert, as introduced by the microSPLiT protocol. This step does not remove sequences generated by random hexamer priming. For reads generated by random hexamers, specific linker sequences are used as anchors to trim the right end of the read, ensuring accurate removal of non-informative regions.
- **Adapter and linker trimming (R1 only):** Sequential removal of specific adapters and linker sequences (e.g., CCACAGTCTCAAGCAC, AGTCGTACGCCGATGCGAAACATCGGCCAC, AGATCGGAAGAGCACACGTCTGAACTCCAGTCA) from R1 with Cutadapt. This step also targets sequences generated by random hexamer priming, using the linker sequences as anchors to trim the right end of the read. These sequences can result from library preparation artifacts or short inserts.
- **Final quality and length filtering (R1 and R2):** Additional quality and length filtering with Fastp on both R1 and R2 to ensure only high-quality, sufficiently long reads are retained.

All steps were performed in paired-end mode to maintain synchronization between R1 and R2. Resource usage (CPU, memory) was monitored and logged for each sample. The pipeline is fully automated and compatible with SLURM-based clusters.

*The complete bash script is provided in the Appendix (see Appendix X).*

### STARsolo alignment and barcode reading






    -   demultiplexage des index de librairies (réalisé par la plateforme de sequençage)

    -   QC control des données avec Andrews, S. (2010). FastQC:  A Quality Control Tool for High Throughput Sequence Data [Online]. Available online at: <http://www.bioinformatics.babraham.ac.uk/projects/fastqc/> et avec [@ewels2016]

    -   trimming des données de seqeunçage avec Fastp [@chen2018] et Cutadapt [@martin2011]

    -   aligment des data sur le genome de reference de *Pseudomonas brassicacearum* grace à STARsolo un amelioration de l'outils STAR pour les données single-cell [@dobin2013][@kaminow]

    -   different other tools existe comme pour alignement et lecture des barcodes SPLiTseq/ microSPliT comme Kallisto [@bray2016], [@sullivan2025] mais d'apres le benchmarking de le plus rapide, reproductible est starsolo [@kuijpers2024]
