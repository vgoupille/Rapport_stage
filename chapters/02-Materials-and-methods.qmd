# Materials and Methods {#sec-materials-and-methods}


## Materials

catfastq to merge the reads from the 4 lanes (https://nf-co.re/rnaseq/3.14.0/)

We have 4 index to improve the quality of the sequencing Illimina 
first step : verify the quality of the reads
we do a fastqc analysis and multiqc to have a global overview of the quality of the reads


then we remove the adapters and low quality reads with cutadapt or Trimmomatic, TrimGalore 



https://cutadapt.readthedocs.io/en/stable/guide.html


https://onlinelibrary.wiley.com/doi/10.1002/imt2.107 
fastp is a tool to improve the quality of the reads



2,5 coupes de queue polyG et polyX
PolyG est un problÃ¨me frÃ©quent observÃ© dans les sÃ©ries Illumina NextSeq et NovaSeq, basÃ©es sur la chimie bicolore. Ces systÃ¨mes utilisent deux lumiÃ¨res diffÃ©rentes (rouge et verte) pour reprÃ©senter quatre bases : une base avec seulement un signal rouge dÃ©tectÃ© est appelÃ©e C ; une base avec seulement un signal vert dÃ©tectÃ© est appelÃ©e T ; une base avec Ã  la fois des lumiÃ¨res rouge et verte dÃ©tectÃ©es est appelÃ©e A ; et une base sans lumiÃ¨re dÃ©tectÃ©e est appelÃ©e G. Cependant, Ã  mesure que le sÃ©quenÃ§age par synthÃ¨se progresse, l'intensitÃ© du signal de chaque cluster d'ADN s'affaiblit progressivement. Ce problÃ¨me entraÃ®ne l'interprÃ©tation erronÃ©e de certaines T et C comme G dans les queues de lecture, un problÃ¨me Ã©galement connu sous le nom de queue polyG.


I will use the fastp because it is more efficient and faster than cutadapt or Trimmomatic

manual : https://open.bioqueue.org/home/knowledge/showKnowledge/sig/fastp
It's also available on github : https://github.com/OpenGene/fastp








 I receiv the data from Genobird plateforme of sequencing the 25 april 2025
 https://umr1087.univ-nantes.fr/research/core-facilities/genobird
 Two types of sequencing data :
- bcl files (raw data from the plateforme of sequencing) (250go)
- fastq files (processed data from the plateforme of sequencing) => we use this one for the moment because they remove the index from the reads (150go)


There are 4 index for Novaseq (BC_0076, BC_0077, BC_0078, BC_0079) : CAGATC, ACTTGA, TAGCTT, GGCTAC. No experimental variation (biological or technical) between the index (Just added for a better quality of sequencing with Novaseq (I'm not sure about this)).


 We don't use the raw data from the plateforme of sequencing (bcl files) maybe later if I want to test to do the demultiplexing of the index (r4)

In fact the plateforme of sequencing already do a demultiplexing of the index (r4). This allows to have a better quality of sequencing with Novaseq.



So we have 8 fastq files ((R1 and R2)*4) (one for each index)
 the index is removed from the R1 and R2 files
 the R1 file contain the  sequence 
 the R2 file contain the barcodes (r1, r2, r3) and the UMI and the index (already removed) CB_UMI_Complex consider of STARsolo consider that bardeodes are on the R2 file


 Do a figure for represent the sequence  (see the formation Norwich and paper of Kuchina)

 I test to directly run STARsolo on the fastq files 
 but I need more space on the server for all run 
 I observe that we don't detect many genes and read (test on BC_0077 which is the file  with the lowest size) 
So we decided to do a fastq quality control with fastqc and multiqc of R1 and R2 files (example in BC_0076)

R2 file is globally correct : we see the barcodes and the UMI
 R1 file is not correct : adapter and low quality sequences at the end of the read

of there are no different between the R1 and R2 files we could combine them in unique files (R1 and R2), for the moment we keep them separate and I test on  BC_0076

 We want to remove the adapters and low quality sequences detected by fastqc many poly at the end of the read


 We use fastp to remove the adapters and low quality sequences detected by fastqc many poly at the end of the read
 before we want to do small file test we need to generate small fastq R1 and R2 files


 list of the Illumina adapters : https://github.com/s-andrews/FastQC/blob/master/Configuration/contaminant_list.txt


manual of fastp : http://open.bioqueue.org/home/knowledge/showKnowledge/sig/fastp

 Script to run fastp on the fastq files
 allow to remove adapters and low quality sequences detected by fastqc 
 The fastq files are in the folder 0_QC/data
 The fastp files are in the folder 1_fastp/data


Test on 250 000 000 reads  


We need to remove the sequences R1 that we don't use in our experiment 

list of the sequences to remove in fastp :  
https://teichlab.github.io/scg_lib_structs/methods_html/SPLiT-seq.html

I will see the result of fastqc to find 



TrÃ¨s bonne question ! Voici pourquoi le â€œInsert size peak : 241 bpâ€ est cohÃ©rent avec les lectures R1 de 241 cycles :

â¸»

ğŸ” DÃ©finition rapide :
	â€¢	Insert size (taille de lâ€™insert) : câ€™est la distance entre le dÃ©but de R1 et la fin de R2 sur la molÃ©cule dâ€™ADN originale, câ€™est-Ã -dire la taille de lâ€™ADN rÃ©ellement sÃ©quencÃ© (hors adaptateurs).
	â€¢	Nombre de cycles : correspond au nombre de bases que le sÃ©quenceur lit par lecture.

â¸»

ğŸ“Š Dans ton cas :
	â€¢	R1 = 241 cycles â†’ chaque lecture R1 peut thÃ©oriquement faire jusquâ€™Ã  241 bases
	â€¢	R2 = 91 cycles â†’ R2 peut faire jusquâ€™Ã  91 bases

Mais attention : les lectures ne couvrent pas toujours la totalitÃ© de lâ€™insert. Cela dÃ©pend de la taille de lâ€™insert fragmentÃ© lors de la prÃ©paration de la librairie.

â¸»

âœ… Pourquoi 241 bp est cohÃ©rent ici ?
	â€¢	Le â€œinsert size peakâ€ reprÃ©sente la valeur la plus frÃ©quente des insert sizes calculÃ©s en alignant les paires de lectures (R1 et R2).
	â€¢	Or, ici on voit que :
	â€¢	Le nombre de cycles de R1 est 241 â‡’ donc on peut lire jusquâ€™Ã  241 bases sur le fragment (avant que R2 commence).
	â€¢	Le fait que lâ€™insert size pic soit Ã  241 signifie que les deux lectures R1 et R2 se chevauchent Ã  peine ou pas du tout, et que lâ€™insert est environ aussi long que la lecture R1.

Donc :

Le pic dâ€™insert size Ã  241 bp signifie que la plupart des fragments dâ€™ADN (les inserts) font la mÃªme longueur que la lecture R1 â†’ cohÃ©rent avec une prÃ©paration oÃ¹ R2 lit le reste ou trÃ¨s peu de lâ€™insert.

â¸»

ğŸ§¬ HypothÃ¨se probable ici :
	â€¢	Tu travailles probablement avec des librairies scRNA-seq adaptÃ©es pour des fragments courts, et tu sÃ©quences surtout Ã  fond R1 (lecture informative).
	â€¢	R2 est plus courte (91 cycles), souvent pour lire un barcode ou UMI â†’ R1 capture le bulk de lâ€™information transcriptomique.

â¸»

ğŸ§  RÃ©sumÃ© :

Insert size = 241 bp, R1 = 241 cycles â†’ la lecture R1 couvre quasiment toute la molÃ©cule. Câ€™est donc cohÃ©rent et attendu dans ce type de design.



 --adapter_sequence_r2=AGATCGGAAGAGCACACGTCTGAACTCCAGTCAC \
      --adapter_sequence=TGTGAGAAAGGGATGTGCTGCGAGAAGGCTAGA





	  Le graphique que tu montres provient de FastQC (via MultiQC) et prÃ©sente les niveaux de duplication des sÃ©quences dans 4 Ã©chantillons. Voici une explication de la variabilitÃ© entre les index observÃ©s :

â¸»

ğŸ” Comprendre le graphe :
	â€¢	Axe X : niveau de duplication (combien de fois chaque sÃ©quence apparaÃ®t).
	â€¢	Axe Y : pourcentage de la librairie.
	â€¢	Lignes vertes : Ã©chantillons avec peu de duplication (bon signe).
	â€¢	Lignes rouges : Ã©chantillons avec forte duplication (plusieurs sÃ©quences prÃ©sentes en trÃ¨s grand nombre).

â¸»

ğŸ“Œ Pourquoi observe-t-on une telle variabilitÃ© entre Ã©chantillons/index ?
	1.	ğŸ“š ComplexitÃ© de la librairie :
	â€¢	Les Ã©chantillons avec peu de duplication (courbe verte) ont probablement une bonne complexitÃ© â†’ beaucoup de sÃ©quences uniques, peu de redondance.
	â€¢	Ceux avec forte duplication (courbes rouges) ont une faible complexitÃ© â†’ trop de sÃ©quences identiques.
	2.	ğŸ“¦ QualitÃ© ou quantitÃ© dâ€™ADN/ARN initial :
	â€¢	Si la quantitÃ© de matÃ©riel initial est faible, il y a un risque de suramplification lors de la PCR, ce qui entraÃ®ne une duplication artificielle des sÃ©quences.
	3.	ğŸ§ª Protocole de prÃ©paration des librairies :
	â€¢	Des diffÃ©rences dans la prÃ©paration des index ou la quantitÃ© dâ€™amplification PCR peuvent induire cette variabilitÃ©.
	â€¢	Mauvaise ligation dâ€™adaptateurs ou biais dâ€™amplification peuvent engendrer une surreprÃ©sentation de certaines sÃ©quences.
	4.	ğŸ”„ Index/swapping ou contamination croisÃ©e :
	â€¢	Si des Ã©chantillons ont Ã©tÃ© mal indexÃ©s ou quâ€™il y a eu du swapping dâ€™index, cela peut crÃ©er une fausse duplication dans un Ã©chantillon.
	â€¢	Des erreurs dans le multiplexing (mÃ©lange dâ€™Ã©chantillons mal contrÃ´lÃ©) peuvent aussi lâ€™expliquer.
	5.	ğŸ§¬ Nature biologique de lâ€™Ã©chantillon :
	â€¢	Certains Ã©chantillons biologiques peuvent contenir naturellement beaucoup de sÃ©quences identiques (ex : sÃ©quences rRNA, transcrits trÃ¨s abondants).
	â€¢	Une transcription trÃ¨s polarisÃ©e (un seul gÃ¨ne trÃ¨s exprimÃ©) peut causer des duplications Ã©levÃ©es.

â¸»

âœ… Que faire ensuite ?
	â€¢	VÃ©rifie les logs de prÃ©paration des librairies (nombre de cycles PCR, quantitÃ©s initiales).
	â€¢	ContrÃ´le la nature des sÃ©quences dupliquÃ©es (rRNA ? contamination ? artefacts PCR ?).
	â€¢	Si la duplication est due Ã  un biais technique, envisage une normalisation, filtrage ou rÃ©analyse avec des mÃ©thodes robustes Ã  la duplication.

Souhaites-tu que je tâ€™aide Ã  analyser un des fichiers FastQC ou MultiQC de ces Ã©chantillons ?






Excellente question ! Pour comprendre lâ€™origine de la duplication dans tes Ã©chantillons, tu peux suivre une dÃ©marche en plusieurs Ã©tapes. Voici comment procÃ©der concrÃ¨tement, avec des outils comme FastQC, MultiQC, et Ã©ventuellement un peu de bioinformatique :

â¸»

ğŸ§ª Ã‰tape 1 : Identifier quels Ã©chantillons sont affectÃ©s
	â€¢	Dans MultiQC, regarde le nom des fichiers / Ã©chantillons associÃ©s aux courbes rouges.
	â€¢	Tu peux passer ta souris sur les courbes dans le rapport MultiQC (ou cliquer sur Â« Summarize plot Â») pour identifier les noms des Ã©chantillons concernÃ©s.

â¸»

ğŸ” Ã‰tape 2 : Inspecter le rapport FastQC individuel

Pour chaque Ã©chantillon avec forte duplication :

ğŸ“ a. Ouvre le rapport fastqc.html

Regarde particuliÃ¨rement ces modules :
	1.	Per base sequence content
â†’ Sâ€™il y a un biais fort (ex. enrichissement en G ou T), cela peut reflÃ©ter une amorce ou adaptateur rÃ©siduel.
	2.	Overrepresented sequences
â†’ Si des sÃ©quences prÃ©cises sont trÃ¨s abondantes, tu verras leurs sÃ©quences et une annotation possible (ex : â€œIllumina adapterâ€, â€œrRNAâ€â€¦).
	3.	K-mer content
â†’ DÃ©tecte des motifs courts (souvent adaptateurs ou contamination PCR) qui sont surreprÃ©sentÃ©s.

â¸»

ğŸ§° Ã‰tape 3 : VÃ©rifier la complexitÃ© de librairie
	1.	Utilise preseq (si possible) pour estimer la diversitÃ© de la librairie et prÃ©dire combien de nouvelles sÃ©quences seraient trouvÃ©es avec plus de sÃ©quenÃ§age.
	2.	VÃ©rifie le nombre de cycles PCR lors de la prÃ©paration (si tu as accÃ¨s aux mÃ©tadonnÃ©es du protocole).

â¸»

ğŸ” Ã‰tape 4 : Aligner et filtrer pour comprendre
	1.	Alignement contre la rÃ©fÃ©rence :
	â€¢	Si la duplication est biologique (ex : gÃ¨ne trÃ¨s exprimÃ©), les sÃ©quences dupliquÃ©es sâ€™aligneront sur le gÃ©nome.
	â€¢	Si câ€™est technique, tu verras des clusters de lectures identiques, souvent non alignÃ©es ou alignÃ©es aux mÃªmes positions.
	2.	Filtrer les reads rRNA ou adaptateurs avec bbduk ou cutadapt.

â¸»

ğŸ“Š Ã‰tape 5 : Comparer les duplications avant/aprÃ¨s nettoyage

AprÃ¨s avoir filtrÃ© ou supprimÃ© des sÃ©quences surreprÃ©sentÃ©es (ex : adaptateurs, rRNA), relance FastQC sur les fichiers nettoyÃ©s pour voir si la duplication baisse.

â¸»

En rÃ©sumÃ© :

Ã‰tape	Objectif	Outil
Identifier Ã©chantillons affectÃ©s	MultiQC	multiqc report.html
Voir sÃ©quences dupliquÃ©es	FastQC (Overrepresented sequences)	fastqc sample.fastq.gz
Filtrer adaptateurs/rRNA	Nettoyage des reads	cutadapt, bbduk, SortMeRNA
Aligner sur gÃ©nome	DÃ©terminer lâ€™origine (biologique ou technique)	bowtie2, STAR, bwa
Estimer complexitÃ© de librairie	Saturation / diversitÃ©	preseq

Souhaites-tu que je tâ€™aide Ã  faire lâ€™un de ces diagnostics Ã©tape par Ã©tape avec tes fichiers ?





Merci pour la prÃ©cision ! Le fait que la variabilitÃ© de duplication concerne le R2 contenant les barcodes (Split-seq) change complÃ¨tement lâ€™interprÃ©tation â€” et câ€™est attendu dans ce cas. Voici pourquoi :

â¸»

âœ… Pourquoi observe-t-on une forte duplication dans les reads R2 (barcodes) en Split-seq ?

ğŸ”¹ 1. R2 ne reflÃ¨te pas lâ€™ARNm, mais les barcodes de marquage cellulaire

Dans Split-seq, le read 2 contient :
	â€¢	Les barcodes de cellule, de well, et parfois des UMI (unique molecular identifiers).
	â€¢	Ces sÃ©quences sont courtes et proviennent dâ€™un nombre limitÃ© de combinaisons (des dizaines Ã  centaines de barcodes possibles).

ğŸ‘‰ Cela veut dire que le contenu du read 2 est volontairement redondant.

ğŸ”¹ 2. RÃ©pÃ©tition intentionnelle de sÃ©quences dans R2

Exemple :
	â€¢	Si tu as 96 puits + 48 barcodes de round 2, tu nâ€™auras que quelques centaines de combinaisons uniques dans R2.
	â€¢	Mais tu as des millions de lectures, donc chaque barcode apparaÃ®t des milliers de fois â†’ duplication Ã©levÃ©e dans R2.

ğŸ”¹ 3. Pas un problÃ¨me de qualitÃ©, mais une consÃ©quence du protocole

Câ€™est normal, attendu, et non problÃ©matique du tout pour lâ€™analyse â€” car ces duplications reprÃ©sentent des barcodes techniques, pas des artefacts de PCR ou de mauvaise prÃ©paration de librairie.

â¸»

ğŸ“Š Pourquoi cette variabilitÃ© entre Ã©chantillons R2 ?

La variabilitÃ© entre Ã©chantillons R2 peut sâ€™expliquer par :

Cause possible	Explication
ğŸ“ˆ Nombre de cellules diffÃ©rentes	Un Ã©chantillon avec moins de cellules aura plus de redondance de barcodes.
ğŸ§¬ RÃ©partition inÃ©gale de barcodes	Mauvais mÃ©lange ou Ã©tiquetage inÃ©gal lors des Ã©tapes de split (rounds de barcoding).
ğŸ§ª EfficacitÃ© du reverse transcription ou capture ARN	Peut biaiser la reprÃ©sentation de certains barcodes.
ğŸ§« Contamination croisÃ©e entre puits	Peut aussi expliquer des duplications anormales.


â¸»

ğŸ§  Ã€ retenir
	â€¢	âœ… Duplication Ã©levÃ©e dans R2 (barcodes Split-seq) est normale.
	â€¢	ğŸ§ª FastQC nâ€™est pas conÃ§u pour interprÃ©ter ce type de donnÃ©es â†’ il est plus utile sur R1 (oÃ¹ se trouve le transcriptome).
	â€¢	âŒ Ne filtre surtout pas ces duplications sur R2.
	â€¢	âœ”ï¸ Continue lâ€™analyse avec des outils comme zUMIs, split-pipe, kb-python, ou le pipeline adaptÃ© Ã  ton protocole Split-seq.

â¸»

Souhaites-tu que je tâ€™aide Ã  identifier automatiquement les barcodes valides ou Ã  prÃ©parer un pipeline pour la phase de â€œdemultiplexingâ€ ?





Oui, exactement : si tu observes des Ã©chantillons R2 (barcodes) sans ou avec trÃ¨s peu de duplication, câ€™est potentiellement problÃ©matique dans un protocole comme Split-seq. Voici pourquoi :

â¸»

âŒ Peu de duplication dans R2 (barcodes) : signal dâ€™alerte

Dans un bon Ã©chantillon de Split-seq :
	â€¢	Le R2 contient des barcodes techniques qui devraient Ãªtre fortement redondants.
	â€¢	Chaque combinaison de barcodes doit Ãªtre lue des milliers de fois (car chaque cellule donne lieu Ã  de nombreuses lectures avec le mÃªme barcode).

Donc, si :
	â€¢	ğŸ“‰ Tu as trÃ¨s peu de duplication dans R2,
	â€¢	Cela signifie probablement que les barcodes sont absents, mal lus ou trop diversifiÃ©s,
	â€¢	Ce qui peut rendre impossible le regroupement des lectures par cellule (la base du single-cell).

â¸»

ğŸ” Causes possibles dâ€™une faible duplication en R2

Cause	Explication
âŒ ProblÃ¨me de lecture du R2 (sÃ©quenÃ§age)	Mauvaise qualitÃ© du read, sÃ©quence illisible, ou erreur de base-calling.
âŒ Mauvais design ou synthÃ¨se des barcodes	Si les barcodes nâ€™ont pas Ã©tÃ© bien intÃ©grÃ©s, ou si des erreurs ont Ã©tÃ© introduites (ex : oligo dÃ©gradÃ©).
âŒ Ã‰chec du marquage lors du split	Si les cellules nâ€™ont pas bien Ã©tÃ© barcodÃ©es (erreur dans les rounds de split).
âŒ Orientation incorrecte ou mauvais parsing	Si lâ€™outil dâ€™analyse lit R2 sans trouver la sÃ©quence attendue (ex : motif de linker/barcode non dÃ©tectÃ©).


â¸»

âœ… Attendu : un pic de duplication dans R2

Dans des donnÃ©es Split-seq fonctionnelles, tu dois voir :
	â€¢	Une forte duplication dans les classes >10, >50, >100, etc. dans R2.
	â€¢	Si un Ã©chantillon nâ€™a pas cela, il peut Ãªtre non-exploitable ou Ã  vÃ©rifier de prÃ¨s.

â¸»

ğŸ§ª Que faire maintenant ?
	1.	Comparer les FastQC de tous les R2 entre Ã©chantillons pour voir sâ€™il y a une vraie anomalie.
	2.	Regarder un Ã©chantillon de sÃ©quences R2 brutes (FASTQ) :
	â€¢	Est-ce que tu vois bien les motifs de barcodes ?
	â€¢	Est-ce quâ€™ils sont bien positionnÃ©s et consistants ?
	3.	Utiliser un outil de parsing de barcodes (comme umi_tools extract ou splitseq-pipe) pour voir combien de barcodes valides sont retrouvÃ©s.

â¸»

Souhaites-tu que je tâ€™aide Ã  Ã©crire un petit script pour explorer la diversitÃ© de barcodes dans les R2 dâ€™un FASTQ ?








reception of the data
-verif data quality 

BARQC  pour recuperer barcode , mieux que starsolo pour les barcodes
verif contamination voir help
 curation des donnÃ©es 

 76 et 80 corr R2 bcp de duplication donc bien mais les deux autres pas Ã§a donc bizarre 

 faire schema avec representation des barcodes 
 
 
 
 fig BARQC 

 fig profondeur de sequenÃ§age amÃ©liore ou pas 
 
 




